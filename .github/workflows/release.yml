name: Upload File to Release

on:
  push:
    tags:
      - "**"   # 自动触发：推送任何 tag 时执行
  workflow_dispatch:   # 添加手动触发配置
    inputs:
      target-tag:
        description: "Tag name to upload to (e.g. 251022)"
        required: true
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Verify file exists
        run: ls execwb-settings.txt || exit 1  # 验证文件存在
        
      - name: Set tag name
        id: set-tag
        run: |
          # 自动触发时使用推送的 tag，手动触发时使用输入的 tag
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            echo "TAG_NAME=${{ github.event.inputs.target-tag }}" >> $GITHUB_ENV
          else
            echo "TAG_NAME=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV
          fi
          
      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        with:
          files: execwb-settings.txt
          tag_name: ${{ env.TAG_NAME }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
